{"version":3,"file":"useField.legacy.cjs","sources":["../../src/useField.tsx"],"sourcesContent":["import React, { useState } from 'react'\nimport { useStore } from '@tanstack/react-store'\nimport type {\n  DeepKeys,\n  DeepValue,\n  FieldOptions,\n  Narrow,\n} from '@tanstack/form-core'\nimport { FieldApi, functionalUpdate } from '@tanstack/form-core'\nimport { useFormContext, formContext } from './formContext'\nimport { useIsomorphicLayoutEffect } from './utils/useIsomorphicLayoutEffect'\nimport type { UseFieldOptions } from './types'\n\ndeclare module '@tanstack/form-core' {\n  // eslint-disable-next-line no-shadow\n  interface FieldApi<TData, TFormData> {\n    Field: FieldComponent<TData, TFormData>\n  }\n}\n\nexport type UseField<TFormData> = <TField extends DeepKeys<TFormData>>(\n  opts?: { name: Narrow<TField> } & UseFieldOptions<\n    DeepValue<TFormData, TField>,\n    TFormData\n  >,\n) => FieldApi<DeepValue<TFormData, TField>, TFormData>\n\nexport function useField<TData, TFormData>(\n  opts: UseFieldOptions<TData, TFormData>,\n): FieldApi<TData, TFormData> {\n  // Get the form API either manually or from context\n  const { formApi, parentFieldName } = useFormContext()\n\n  const [fieldApi] = useState<FieldApi<TData, TFormData>>(() => {\n    const name = (\n      typeof opts.index === 'number'\n        ? [parentFieldName, opts.index, opts.name]\n        : [parentFieldName, opts.name]\n    )\n      .filter((d) => d !== undefined)\n      .join('.')\n\n    const api = new FieldApi({ ...opts, form: formApi, name: name as any })\n\n    api.Field = Field as any\n\n    return api\n  })\n\n  /**\n   * fieldApi.update should not have any side effects. Think of it like a `useRef`\n   * that we need to keep updated every render with the most up-to-date information.\n   */\n  useIsomorphicLayoutEffect(() => {\n    fieldApi.update({ ...opts, form: formApi } as never)\n  })\n\n  useStore(\n    fieldApi.store as any,\n    opts.mode === 'array'\n      ? (state: any) => {\n          return [state.meta, Object.keys(state.value || []).length]\n        }\n      : undefined,\n  )\n\n  // Instantiates field meta and removes it when unrendered\n  useIsomorphicLayoutEffect(() => fieldApi.mount(), [fieldApi])\n\n  return fieldApi\n}\n\n// export type FieldValue<TFormData, TField> = TFormData extends any[]\n//   ? TField extends `[${infer TIndex extends number | 'i'}].${infer TRest}`\n//     ? DeepValue<TFormData[TIndex extends 'i' ? number : TIndex], TRest>\n//     : TField extends `[${infer TIndex extends number | 'i'}]`\n//     ? TFormData[TIndex extends 'i' ? number : TIndex]\n//     : never\n//   : TField extends `${infer TPrefix}[${infer TIndex extends\n//       | number\n//       | 'i'}].${infer TRest}`\n//   ? DeepValue<\n//       DeepValue<TFormData, TPrefix>[TIndex extends 'i' ? number : TIndex],\n//       TRest\n//     >\n//   : TField extends `${infer TPrefix}[${infer TIndex extends number | 'i'}]`\n//   ? DeepValue<TFormData, TPrefix>[TIndex extends 'i' ? number : TIndex]\n//   : DeepValue<TFormData, TField>\n\nexport type FieldValue<TFormData, TField> = TFormData extends any[]\n  ? unknown extends TField\n    ? TFormData[number]\n    : DeepValue<TFormData[number], TField>\n  : DeepValue<TFormData, TField>\n\n// type Test1 = FieldValue<{ foo: { bar: string }[] }, 'foo'>\n// //   ^?\n// type Test2 = FieldValue<{ foo: { bar: string }[] }, 'foo[i]'>\n// //   ^?\n// type Test3 = FieldValue<{ foo: { bar: string }[] }, 'foo[2].bar'>\n// //   ^?\n\nexport type FieldComponent<TParentData, TFormData> = <TField>({\n  children,\n  ...fieldOptions\n}: {\n  children: (\n    fieldApi: FieldApi<FieldValue<TParentData, TField>, TFormData>,\n  ) => any\n} & Omit<\n  UseFieldOptions<FieldValue<TParentData, TField>, TFormData>,\n  'name' | 'index'\n> &\n  (TParentData extends any[]\n    ? {\n        name?: TField extends undefined ? TField : DeepKeys<TParentData>\n        index: number\n      }\n    : {\n        name: TField extends undefined ? TField : DeepKeys<TParentData>\n        index?: never\n      })) => any\n\nexport function Field<TData, TFormData>({\n  children,\n  ...fieldOptions\n}: {\n  children: (fieldApi: FieldApi<TData, TFormData>) => any\n} & UseFieldOptions<TData, TFormData>) {\n  const fieldApi = useField(fieldOptions as any)\n\n  return (\n    <formContext.Provider\n      value={{ formApi: fieldApi.form, parentFieldName: fieldApi.name }}\n      children={functionalUpdate(children, fieldApi as any)}\n    />\n  )\n}\n"],"names":["useField","opts","formApi","parentFieldName","useFormContext","fieldApi","useState","name","index","filter","d","undefined","join","api","FieldApi","form","Field","useIsomorphicLayoutEffect","update","useStore","store","mode","state","meta","Object","keys","value","length","mount","children","fieldOptions","React","createElement","formContext","Provider","functionalUpdate"],"mappings":";;;;;;;;AA2BO,SAASA,QAAQA,CACtBC,IAAuC,EACX;AAC5B;EACA,MAAM;IAAEC,OAAO;AAAEC,IAAAA,eAAAA;GAAiB,GAAGC,0BAAc,EAAE,CAAA;AAErD,EAAA,MAAM,CAACC,QAAQ,CAAC,GAAGC,cAAQ,CAA6B,MAAM;AAC5D,IAAA,MAAMC,IAAI,GAAG,CACX,OAAON,IAAI,CAACO,KAAK,KAAK,QAAQ,GAC1B,CAACL,eAAe,EAAEF,IAAI,CAACO,KAAK,EAAEP,IAAI,CAACM,IAAI,CAAC,GACxC,CAACJ,eAAe,EAAEF,IAAI,CAACM,IAAI,CAAC,EAE/BE,MAAM,CAAEC,CAAC,IAAKA,CAAC,KAAKC,SAAS,CAAC,CAC9BC,IAAI,CAAC,GAAG,CAAC,CAAA;AAEZ,IAAA,MAAMC,GAAG,GAAG,IAAIC,iBAAQ,CAAC;AAAE,MAAA,GAAGb,IAAI;AAAEc,MAAAA,IAAI,EAAEb,OAAO;AAAEK,MAAAA,IAAI,EAAEA,IAAAA;AAAY,KAAC,CAAC,CAAA;IAEvEM,GAAG,CAACG,KAAK,GAAGA,KAAY,CAAA;AAExB,IAAA,OAAOH,GAAG,CAAA;AACZ,GAAC,CAAC,CAAA;;AAEF;AACF;AACA;AACA;AACEI,EAAAA,mDAAyB,CAAC,MAAM;IAC9BZ,QAAQ,CAACa,MAAM,CAAC;AAAE,MAAA,GAAGjB,IAAI;AAAEc,MAAAA,IAAI,EAAEb,OAAAA;AAAQ,KAAU,CAAC,CAAA;AACtD,GAAC,CAAC,CAAA;AAEFiB,EAAAA,mBAAQ,CACNd,QAAQ,CAACe,KAAK,EACdnB,IAAI,CAACoB,IAAI,KAAK,OAAO,GAChBC,KAAU,IAAK;AACd,IAAA,OAAO,CAACA,KAAK,CAACC,IAAI,EAAEC,MAAM,CAACC,IAAI,CAACH,KAAK,CAACI,KAAK,IAAI,EAAE,CAAC,CAACC,MAAM,CAAC,CAAA;GAC3D,GACDhB,SACN,CAAC,CAAA;;AAED;EACAM,mDAAyB,CAAC,MAAMZ,QAAQ,CAACuB,KAAK,EAAE,EAAE,CAACvB,QAAQ,CAAC,CAAC,CAAA;AAE7D,EAAA,OAAOA,QAAQ,CAAA;AACjB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AAuBO,SAASW,KAAKA,CAAmB;EACtCa,QAAQ;EACR,GAAGC,YAAAA;AAG+B,CAAC,EAAE;AACrC,EAAA,MAAMzB,QAAQ,GAAGL,QAAQ,CAAC8B,YAAmB,CAAC,CAAA;AAE9C,EAAA,oBACEC,KAAA,CAAAC,aAAA,CAACC,uBAAW,CAACC,QAAQ,EAAA;AACnBR,IAAAA,KAAK,EAAE;MAAExB,OAAO,EAAEG,QAAQ,CAACU,IAAI;MAAEZ,eAAe,EAAEE,QAAQ,CAACE,IAAAA;KAAO;AAClEsB,IAAAA,QAAQ,EAAEM,yBAAgB,CAACN,QAAQ,EAAExB,QAAe,CAAA;AAAE,GACvD,CAAC,CAAA;AAEN;;;;;"}