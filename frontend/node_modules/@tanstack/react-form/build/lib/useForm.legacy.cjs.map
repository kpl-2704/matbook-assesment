{"version":3,"file":"useForm.legacy.cjs","sources":["../../src/useForm.tsx"],"sourcesContent":["import type { FormState, FormOptions } from '@tanstack/form-core'\nimport { FormApi, functionalUpdate } from '@tanstack/form-core'\nimport type { NoInfer } from '@tanstack/react-store'\nimport { useStore } from '@tanstack/react-store'\nimport React, { type ReactNode, useState } from 'react'\nimport { type UseField, type FieldComponent, Field, useField } from './useField'\nimport { formContext } from './formContext'\nimport { useIsomorphicLayoutEffect } from './utils/useIsomorphicLayoutEffect'\n\ndeclare module '@tanstack/form-core' {\n  // eslint-disable-next-line no-shadow\n  interface FormApi<TFormData> {\n    Provider: (props: { children: any }) => any\n    Field: FieldComponent<TFormData, TFormData>\n    useField: UseField<TFormData>\n    useStore: <TSelected = NoInfer<FormState<TFormData>>>(\n      selector?: (state: NoInfer<FormState<TFormData>>) => TSelected,\n    ) => TSelected\n    Subscribe: <TSelected = NoInfer<FormState<TFormData>>>(props: {\n      selector?: (state: NoInfer<FormState<TFormData>>) => TSelected\n      children: ((state: NoInfer<TSelected>) => ReactNode) | ReactNode\n    }) => any\n  }\n}\n\nexport function useForm<TData>(opts?: FormOptions<TData>): FormApi<TData> {\n  const [formApi] = useState(() => {\n    // @ts-ignore\n    const api = new FormApi<TData>(opts)\n\n    // eslint-disable-next-line react/display-name\n    api.Provider = (props) => (\n      <formContext.Provider {...props} value={{ formApi: api }} />\n    )\n    api.Field = Field as any\n    api.useField = useField as any\n    api.useStore = (\n      // @ts-ignore\n      selector,\n    ) => {\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      return useStore(api.store as any, selector as any) as any\n    }\n    api.Subscribe = (\n      // @ts-ignore\n      props,\n    ) => {\n      return functionalUpdate(\n        props.children,\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        useStore(api.store as any, props.selector as any),\n      ) as any\n    }\n\n    return api\n  })\n\n  formApi.useStore((state) => state.isSubmitting)\n\n  /**\n   * formApi.update should not have any side effects. Think of it like a `useRef`\n   * that we need to keep updated every render with the most up-to-date information.\n   */\n  useIsomorphicLayoutEffect(() => {\n    formApi.update(opts)\n  })\n\n  return formApi as any\n}\n"],"names":["useForm","opts","formApi","useState","api","FormApi","Provider","props","React","createElement","formContext","_extends","value","Field","useField","useStore","selector","store","Subscribe","functionalUpdate","children","state","isSubmitting","useIsomorphicLayoutEffect","update"],"mappings":";;;;;;;;;;AAyBO,SAASA,OAAOA,CAAQC,IAAyB,EAAkB;AACxE,EAAA,MAAM,CAACC,OAAO,CAAC,GAAGC,cAAQ,CAAC,MAAM;AAC/B;AACA,IAAA,MAAMC,GAAG,GAAG,IAAIC,gBAAO,CAAQJ,IAAI,CAAC,CAAA;;AAEpC;AACAG,IAAAA,GAAG,CAACE,QAAQ,GAAIC,KAAK,iBACnBC,KAAA,CAAAC,aAAA,CAACC,uBAAW,CAACJ,QAAQ,EAAAK,iCAAA,KAAKJ,KAAK,EAAA;AAAEK,MAAAA,KAAK,EAAE;AAAEV,QAAAA,OAAO,EAAEE,GAAAA;AAAI,OAAA;AAAE,KAAA,CAAE,CAC5D,CAAA;IACDA,GAAG,CAACS,KAAK,GAAGA,cAAY,CAAA;IACxBT,GAAG,CAACU,QAAQ,GAAGA,iBAAe,CAAA;IAC9BV,GAAG,CAACW,QAAQ,GAAG;AACb;AACAC,IAAAA,QAAQ,KACL;AACH;AACA,MAAA,OAAOD,mBAAQ,CAACX,GAAG,CAACa,KAAK,EAASD,QAAe,CAAC,CAAA;KACnD,CAAA;IACDZ,GAAG,CAACc,SAAS,GAAG;AACd;AACAX,IAAAA,KAAK,KACF;AACH,MAAA,OAAOY,yBAAgB,CACrBZ,KAAK,CAACa,QAAQ;AACd;MACAL,mBAAQ,CAACX,GAAG,CAACa,KAAK,EAASV,KAAK,CAACS,QAAe,CAClD,CAAC,CAAA;KACF,CAAA;AAED,IAAA,OAAOZ,GAAG,CAAA;AACZ,GAAC,CAAC,CAAA;EAEFF,OAAO,CAACa,QAAQ,CAAEM,KAAK,IAAKA,KAAK,CAACC,YAAY,CAAC,CAAA;;AAE/C;AACF;AACA;AACA;AACEC,EAAAA,mDAAyB,CAAC,MAAM;AAC9BrB,IAAAA,OAAO,CAACsB,MAAM,CAACvB,IAAI,CAAC,CAAA;AACtB,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOC,OAAO,CAAA;AAChB;;;;"}