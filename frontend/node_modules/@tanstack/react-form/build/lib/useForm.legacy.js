import { extends as _extends } from './_virtual/_rollupPluginBabelHelpers.legacy.js';
import { FormApi, functionalUpdate } from '@tanstack/form-core';
import { useStore } from '@tanstack/react-store';
import React__default, { useState } from 'react';
import { Field, useField } from './useField.legacy.js';
import { formContext } from './formContext.legacy.js';
import { useIsomorphicLayoutEffect } from './utils/useIsomorphicLayoutEffect.legacy.js';

function useForm(opts) {
  const [formApi] = useState(() => {
    // @ts-ignore
    const api = new FormApi(opts);

    // eslint-disable-next-line react/display-name
    api.Provider = props => /*#__PURE__*/React__default.createElement(formContext.Provider, _extends({}, props, {
      value: {
        formApi: api
      }
    }));
    api.Field = Field;
    api.useField = useField;
    api.useStore = (
    // @ts-ignore
    selector) => {
      // eslint-disable-next-line react-hooks/rules-of-hooks
      return useStore(api.store, selector);
    };
    api.Subscribe = (
    // @ts-ignore
    props) => {
      return functionalUpdate(props.children,
      // eslint-disable-next-line react-hooks/rules-of-hooks
      useStore(api.store, props.selector));
    };
    return api;
  });
  formApi.useStore(state => state.isSubmitting);

  /**
   * formApi.update should not have any side effects. Think of it like a `useRef`
   * that we need to keep updated every render with the most up-to-date information.
   */
  useIsomorphicLayoutEffect(() => {
    formApi.update(opts);
  });
  return formApi;
}

export { useForm };
//# sourceMappingURL=useForm.legacy.js.map
