'use strict';

var _rollupPluginBabelHelpers = require('./_virtual/_rollupPluginBabelHelpers.legacy.cjs');
var formCore = require('@tanstack/form-core');
var reactStore = require('@tanstack/react-store');
var React = require('react');
var useField = require('./useField.legacy.cjs');
var formContext = require('./formContext.legacy.cjs');
var useIsomorphicLayoutEffect = require('./utils/useIsomorphicLayoutEffect.legacy.cjs');

function useForm(opts) {
  const [formApi] = React.useState(() => {
    // @ts-ignore
    const api = new formCore.FormApi(opts);

    // eslint-disable-next-line react/display-name
    api.Provider = props => /*#__PURE__*/React.createElement(formContext.formContext.Provider, _rollupPluginBabelHelpers.extends({}, props, {
      value: {
        formApi: api
      }
    }));
    api.Field = useField.Field;
    api.useField = useField.useField;
    api.useStore = (
    // @ts-ignore
    selector) => {
      // eslint-disable-next-line react-hooks/rules-of-hooks
      return reactStore.useStore(api.store, selector);
    };
    api.Subscribe = (
    // @ts-ignore
    props) => {
      return formCore.functionalUpdate(props.children,
      // eslint-disable-next-line react-hooks/rules-of-hooks
      reactStore.useStore(api.store, props.selector));
    };
    return api;
  });
  formApi.useStore(state => state.isSubmitting);

  /**
   * formApi.update should not have any side effects. Think of it like a `useRef`
   * that we need to keep updated every render with the most up-to-date information.
   */
  useIsomorphicLayoutEffect.useIsomorphicLayoutEffect(() => {
    formApi.update(opts);
  });
  return formApi;
}

exports.useForm = useForm;
//# sourceMappingURL=useForm.legacy.cjs.map
